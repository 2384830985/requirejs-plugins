<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>RequireJS Async plugin</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <div id="wrapper">
            <h1>RequireJS async plugin</h1>
            <p style="max-width:600px">
                Google Maps loads many JS files asynchronously, so listening just to the first script load
                isn't enough to check if it is ready to be used, another problem is that the regular gmaps script
                uses document.write, so we need to pass a `callback` parameter to make it not use `document.write`
                and wait for the callback call.
                <br>
                [<a href="http://code.google.com/apis/maps/documentation/javascript/basics.html#Async">More info</a>]
            </p>
            <div id="map-canvas" style="width:400px; height:300px; border:1px solid #ccc; background-color:#f5f5f5"></div>
        </div>
        <script src="../lib/require.js"></script>
        <script>
            require({
                waitSeconds : 45, //make sure it is enough to load all gmaps scripts
                paths : {
                    async : '../src/async' //alias to plugin
                }
            });

            // !callback  is used to specify name of parameter that expects callback function name
            require(['async!http://maps.google.com/maps/api/js?sensor=false!callback'], function(){

                //Google maps is available and all components are ready to use.

                var mapDiv = document.getElementById('map-canvas');

                var map = new google.maps.Map(mapDiv, {
                    center: new google.maps.LatLng(37.4419, -122.1419),
                    zoom: 13,
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    navigationControl: true,
                    navigationControlOptions: {
                        style: google.maps.NavigationControlStyle.SMALL
                    }
                });

            });

        </script>
    </body>
</html>
